# Photo Watermark 2 需求文档

## 项目概述

Photo Watermark 2 是一个专为 macOS 设计的桌面图片水印应用程序，使用 Java 和 JavaFX 技术栈开发。

## 功能需求

### 1. 文件处理

#### 1.1 导入图片
- **基础功能**
  - [x] 支持单张图片拖拽导入
  - [x] 支持通过文件选择器导入单张图片
  - [ ] 支持批量导入，可一次性选择多张图片
  - [ ] 支持直接导入整个文件夹
  - [ ] 在界面上显示已导入图片的列表（缩略图和文件名）

#### 1.2 支持格式
- **输入格式**
  - [ ] 必须支持：JPEG, PNG
  - [ ] 强烈建议支持：BMP, TIFF
  - [ ] PNG 格式必须支持透明通道
- **输出格式**
  - [ ] 用户可选择输出为 JPEG 或 PNG

#### 1.3 导出图片
- **基础功能**
  - [ ] 用户可指定一个输出文件夹
  - [ ] 默认禁止导出到原文件夹（防止覆盖原图）
  - [ ] 提供导出文件命名规则选项：
    - [ ] 保留原文件名
    - [ ] 添加自定义前缀（如 wm_）
    - [ ] 添加自定义后缀（如 _watermarked）
- **高级功能**
  - [ ] 对于 JPEG 格式，提供图片质量（压缩率）调节滑块（0-100）
  - [ ] 导出时允许用户调整图片尺寸（按宽度、高度或百分比缩放）

### 2. 水印类型

#### 2.1 文本水印
- **基础功能**
  - [ ] 内容：用户可自定义输入任意文本
  - [ ] 透明度：可调节文本的透明度（0-100%）
- **高级功能**
  - [ ] 字体：可选择系统已安装的字体、字号、粗体、斜体
  - [ ] 颜色：提供调色板让用户选择字体颜色
  - [ ] 样式：可添加阴影或描边效果，以增强在复杂背景下的可读性

#### 2.2 图片水印（高级功能）
- [ ] 用户可从本地选择一张图片（如Logo）作为水印
- [ ] 必须支持带透明通道的 PNG 图片
- [ ] 缩放：可按比例或自由调整图片水印的大小
- [ ] 透明度：可调节图片水印的整体透明度（0-100%）

### 3. 水印布局与样式

#### 3.1 实时预览
- [ ] 所有对水印的调整都应在主预览窗口中实时显示效果
- [ ] 用户可以点击图片列表切换预览不同的图片

#### 3.2 位置
- [ ] 预设位置：提供九宫格布局（四角、正中心），用户可一键将水印放置在这些位置
- [ ] 手动拖拽：用户可以直接在预览图上通过鼠标拖拽水印到任意位置

#### 3.3 旋转（高级功能）
- [ ] 提供一个滑块或输入框，允许用户以任意角度旋转水印

### 4. 配置管理

#### 4.1 水印模板
- [ ] 用户可以将当前的水印设置（包括水印内容、字体、颜色、位置、大小、透明度等所有参数）保存为一个模板
- [ ] 用户可以加载、管理和删除已保存的模板
- [ ] 程序启动时可自动加载上一次关闭时的设置或一个默认模板

## 技术需求

### 开发环境
- **编程语言**: Java 17
- **UI 框架**: JavaFX 17
- **构建工具**: Maven
- **目标平台**: macOS 10.14+

### 技术栈
- **图像处理**: Java BufferedImage + Apache Commons Imaging
- **数据序列化**: Jackson JSON（用于模板保存）
- **测试框架**: JUnit 5

### 性能要求
- 支持处理最大 50MB 的单张图片
- 批量处理时支持同时处理最多 100 张图片
- 实时预览响应时间不超过 500ms

### 用户体验要求
- 界面简洁直观，符合 macOS 设计规范
- 支持拖拽操作
- 提供快捷键支持
- 错误提示友好明确

## 交付要求

### 代码质量
- 遵循 Java 编码规范
- 代码注释覆盖率不低于 60%
- 单元测试覆盖率不低于 70%

### 文档要求
- 完整的 README.md
- 详细的需求文档
- API 文档（如有）
- 用户使用手册

### 版本控制
- 使用 Git 进行版本控制
- 提交信息规范，遵循 Conventional Commits
- 保留详细的提交记录

### 发布要求
- 提供可直接运行的 macOS 应用程序
- 在 GitHub 上创建 Release
- 提供安装和使用说明

## 开发计划

### 第一阶段：基础功能（优先级：高）
1. 项目初始化和基础配置
2. 基础 UI 框架搭建
3. 文件导入功能（单张图片）
4. 图片显示和预览
5. 基础文本水印功能
6. 水印位置控制（九宫格）
7. 基础导出功能

### 第二阶段：批量处理（优先级：中）
1. 批量导入功能
2. 批量处理和导出

### 第三阶段：高级功能（优先级：中）
1. 高级文本水印功能（字体、颜色、样式）
2. 图片水印功能
3. 手动拖拽定位
4. 水印旋转

### 第四阶段：配置管理（优先级：低）
1. 水印模板保存和加载
2. 模板管理界面
3. 设置持久化

## 验收标准

### 功能验收
- [ ] 所有基础功能正常工作
- [ ] 支持的图片格式能正确处理
- [ ] 水印效果符合预期
- [ ] 导出功能正常，文件命名规则正确

### 性能验收
- [ ] 应用启动时间不超过 3 秒
- [ ] 图片加载和预览流畅
- [ ] 批量处理不出现内存溢出

### 兼容性验收
- [ ] 在 macOS 10.14+ 系统上正常运行
- [ ] 支持不同分辨率的显示器
- [ ] 支持深色模式（可选）

### 用户体验验收
- [ ] 界面布局合理，操作直观
- [ ] 错误处理完善，提示信息清晰
- [ ] 支持常用快捷键操作